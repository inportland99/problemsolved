---
layout: minimal.njk
title: Pizza Dough Calculator (Biga Method)
description: Calculate ingredients for pizza dough using the biga method
---

<div class="container mx-auto px-4 py-8 max-w-2xl">
  <!-- User info bar -->
  <div id="user-info" class="mb-4 flex justify-between items-center gap-2">
    <a href="/pizza-dashboard/" class="btn btn-sm btn-ghost">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      My Recipes
    </a>
    <div class="flex items-center gap-2">
      <span id="user-email" class="text-sm text-gray-600"></span>
      <button id="logout-btn" class="btn btn-sm btn-outline">Logout</button>
    </div>
  </div>
  
  <h1 class="text-3xl font-bold text-center mb-8">Biga Pizza Dough</h1>
  <h3 class="text-1xl font-bold text-center mb-8">Poom Poom Poom!</h3>
  
  <!-- Alert for save status -->
  <div id="save-alert" class="alert hidden mb-4">
    <span id="save-alert-text"></span>
  </div>
  
  <!-- Progress indicator -->
  <div class="flex justify-center gap-2 mb-6">
    <div class="h-2 w-2 rounded-full bg-primary panel-dot" data-panel="0"></div>
    <div class="h-2 w-2 rounded-full bg-base-300 panel-dot" data-panel="1"></div>
    <div class="h-2 w-2 rounded-full bg-base-300 panel-dot" data-panel="2"></div>
    <div class="h-2 w-2 rounded-full bg-base-300 panel-dot" data-panel="3"></div>
    <div class="h-2 w-2 rounded-full bg-base-300 panel-dot" data-panel="4"></div>
  </div>

  <!-- Panels container -->
  <div class="panels-container overflow-hidden touch-pan-y">
    <div class="panels-wrapper flex transition-transform duration-300">
      
      <!-- Panel 1: Input -->
      <div class="panel w-full flex-shrink-0 px-4">
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">Step 1: Recipe Settings</h2>
            
            <div class="form-control mb-4">
              <label class="label">
                <span class="label-text font-semibold">Number of dough balls</span>
              </label>
              <input type="number" id="doughBalls" min="1" max="20" value="8" 
                     class="input input-bordered input-primary text-lg" />
            </div>

            <div class="form-control mb-4">
              <label class="label">
                <span class="label-text font-semibold">Dough ball size (g)</span>
              </label>
              <input type="number" id="ballSize" min="100" max="500" value="290" step="10"
                     class="input input-bordered input-primary text-lg" />
            </div>

            <div class="form-control mb-4">
              <label class="label">
                <span class="label-text font-semibold">Hydration (%)</span>
              </label>
              <input type="number" id="hydration" min="50" max="80" value="75" 
                     class="input input-bordered input-primary text-lg" />
              <label class="label">
                <span class="label-text-alt">Between 50% and 80%</span>
              </label>
            </div>

            <div class="form-control mb-4">
              <label class="label">
                <span class="label-text font-semibold">Flour type</span>
              </label>
              <select id="flourType" class="select select-bordered select-primary text-lg">
                <option value="semolina">Semolina</option>
                <option value="00pizza" selected>00 Pizza</option>
                <option value="allpurpose">All Purpose</option>
                <option value="other">Other</option>
              </select>
            </div>
            
            <div class="divider"></div>
            
            <button type="button" id="save-recipe-btn" class="btn btn-secondary w-full">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
              </svg>
              <span>Save Recipe</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Panel 2: Biga -->
      <div class="panel w-full flex-shrink-0 px-4">
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">Step 2: Make the Biga</h2>
            <p class="mb-4">Mix these ingredients and let ferment 12-24 hours:</p>
            
            <div class="space-y-3">
              <div class="flex justify-between items-center p-3 bg-base-200 rounded-lg">
                <span class="font-semibold">Flour</span>
                <span class="text-xl" id="biga-flour">--</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-base-200 rounded-lg">
                <span class="font-semibold">Water</span>
                <span class="text-xl" id="biga-water">--</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-base-200 rounded-lg">
                <span class="font-semibold">Yeast</span>
                <span class="text-xl" id="biga-yeast">--</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel 3: Add to Biga -->
      <div class="panel w-full flex-shrink-0 px-4">
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">Step 3: Add to Biga</h2>
            <p class="mb-4">Add these ingredients to your biga and mix:</p>
            
            <div class="space-y-3">
              <div class="flex justify-between items-center p-3 bg-base-200 rounded-lg">
                <span class="font-semibold">Flour</span>
                <span class="text-xl" id="add-flour">--</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-base-200 rounded-lg">
                <span class="font-semibold">Water</span>
                <span class="text-xl" id="add-water">--</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-base-200 rounded-lg">
                <span class="font-semibold">Yeast</span>
                <span class="text-xl" id="add-yeast">--</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel 4: Salt Water -->
      <div class="panel w-full flex-shrink-0 px-4">
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">Step 4: Build Gluten</h2>
            <p class="mb-4">Mix and build gluten by adding salt water one spoon a time:</p>
            
            <div class="space-y-3">
              <div class="flex justify-between items-center p-3 bg-base-200 rounded-lg">
                <span class="font-semibold">Water</span>
                <span class="text-xl" id="salt-water">--</span>
              </div>
              <div class="flex justify-between items-center p-3 bg-base-200 rounded-lg">
                <span class="font-semibold">Salt</span>
                <span class="text-xl" id="salt-amount">--</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel 5: Final Steps -->
      <div class="panel w-full flex-shrink-0 px-4">
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">Step 5: Final Steps</h2>
            
            <ul class="space-y-4">
              <li class="flex items-start gap-3">
                <span class="text-primary text-xl">‚Ä¢</span>
                <span>Take it out and put into oiled bowl.</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-primary text-xl">‚Ä¢</span>
                <span>Cover and let rest for 30 minutes.</span>
              </li>
              <li class="flex items-start gap-3">
                <span class="text-primary text-xl">‚Ä¢</span>
                <span>Then make the dough balls.</span>
              </li>
            </ul>

            <div class="alert alert-success mt-6">
              <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
              <span>Your dough is ready to rise!</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Navigation buttons -->
  <div class="flex justify-between mt-6 px-4">
    <button id="prevBtn" class="btn btn-outline" disabled>Previous</button>
    <button id="nextBtn" class="btn btn-primary">Next</button>
  </div>
</div>

<script type="module">
import { getCurrentUser, signOut } from '/assets/js/supabase-client.js';
import { savePizzaLog } from '/assets/js/pizza-db.js';

// Check authentication on page load
const user = await getCurrentUser();
if (!user) {
  window.location.href = '/pizza-login/';
} else {
  // Display user email
  document.getElementById('user-email').textContent = user.email;
}

// Logout functionality
document.getElementById('logout-btn').addEventListener('click', async () => {
  await signOut();
  window.location.href = '/pizza-login/';
});

// Alert functions
function showSaveAlert(message, type = 'error') {
  const alert = document.getElementById('save-alert');
  const alertText = document.getElementById('save-alert-text');
  
  alert.className = `alert mb-4 ${type === 'error' ? 'alert-error' : 'alert-success'}`;
  alertText.textContent = message;
  alert.classList.remove('hidden');
  
  // Auto-hide after 5 seconds
  setTimeout(() => {
    alert.classList.add('hidden');
  }, 5000);
}

// Save recipe functionality
document.getElementById('save-recipe-btn').addEventListener('click', async () => {
  const flourType = document.getElementById('flourType').value;
  const doughBalls = parseInt(document.getElementById('doughBalls').value);
  const ballSize = parseInt(document.getElementById('ballSize').value);
  const hydration = parseInt(document.getElementById('hydration').value);
  
  // Validate inputs
  if (!flourType || isNaN(doughBalls) || isNaN(ballSize) || isNaN(hydration)) {
    showSaveAlert('Please fill in all fields', 'error');
    return;
  }
  
  if (doughBalls < 1 || ballSize < 100 || hydration < 50 || hydration > 80) {
    showSaveAlert('Please enter valid values', 'error');
    return;
  }
  
  // Show loading state
  const btn = document.getElementById('save-recipe-btn');
  const btnText = btn.querySelector('span:last-child');
  const originalText = btnText.textContent;
  btnText.textContent = 'Saving...';
  btn.disabled = true;
  
  // Save to database
  const result = await savePizzaLog(flourType, doughBalls, ballSize, hydration);
  
  // Reset button state
  btnText.textContent = originalText;
  btn.disabled = false;
  
  if (result.success) {
    const message = 'Recipe saved successfully! üçï ';
    const link = '<a href="/pizza-dashboard/" class="underline font-semibold">View all recipes</a>';
    const alert = document.getElementById('save-alert');
    const alertText = document.getElementById('save-alert-text');
    
    alert.className = 'alert mb-4 alert-success';
    alertText.innerHTML = message + link;
    alert.classList.remove('hidden');
    
    setTimeout(() => {
      alert.classList.add('hidden');
    }, 5000);
  } else {
    showSaveAlert(result.error?.message || 'Failed to save recipe', 'error');
  }
});

let currentPanel = 0;
const totalPanels = 5;

function updatePanelDisplay() {
  const wrapper = document.querySelector('.panels-wrapper');
  wrapper.style.transform = `translateX(-${currentPanel * 100}%)`;
  
  // Update progress dots
  document.querySelectorAll('.panel-dot').forEach((dot, index) => {
    if (index === currentPanel) {
      dot.classList.remove('bg-base-300');
      dot.classList.add('bg-primary');
    } else {
      dot.classList.remove('bg-primary');
      dot.classList.add('bg-base-300');
    }
  });
  
  // Update button states
  document.getElementById('prevBtn').disabled = currentPanel === 0;
  document.getElementById('nextBtn').disabled = currentPanel === totalPanels - 1;
  
  if (currentPanel === totalPanels - 1) {
    document.getElementById('nextBtn').textContent = 'Done';
  } else {
    document.getElementById('nextBtn').textContent = 'Next';
  }
}

function nextPanel() {
  if (currentPanel === 0) {
    calculateRecipe();
  }
  if (currentPanel < totalPanels - 1) {
    currentPanel++;
    updatePanelDisplay();
  }
}

function prevPanel() {
  if (currentPanel > 0) {
    currentPanel--;
    updatePanelDisplay();
  }
}

function calculateRecipe() {
  const doughBalls = parseFloat(document.getElementById('doughBalls').value);
  const ballSize = parseFloat(document.getElementById('ballSize').value);
  const hydration = parseFloat(document.getElementById('hydration').value);
  
  // Validate inputs
  if (isNaN(doughBalls) || doughBalls < 1 || isNaN(ballSize) || ballSize < 100 || isNaN(hydration) || hydration < 50 || hydration > 80) {
    alert('Please enter valid values');
    return;
  }
  
  // Calculate total flour
  const totalFlour = (ballSize * doughBalls * 100) / (100 + hydration + 3);
  
  // Biga ingredients
  const bigaFlour = totalFlour / 2;
  const bigaWater = bigaFlour / 2;
  const bigaYeast = (totalFlour / 2) * 0.003;
  
  // Add to biga
  const addFlour = totalFlour / 2;
  const addWater = (totalFlour * hydration/100 - bigaWater) / 2;
  const addYeast = (totalFlour / 2) * 0.003;
  
  // Salt water
  const saltWater = (totalFlour * hydration/100 - bigaWater) / 2;
  const salt = totalFlour * 0.03;
  
  // Display biga (flour to nearest 10g, water to nearest 5g, yeast to nearest 0.1g)
  document.getElementById('biga-flour').textContent = `${Math.round(bigaFlour / 1) * 1}g`;
  document.getElementById('biga-water').textContent = `${Math.round(bigaWater / 1) * 1}g`;
  document.getElementById('biga-yeast').textContent = `${Math.round(bigaYeast * 10) / 10}g`;
  
  // Display add to biga (flour to nearest 10g, water to nearest 5g, yeast to nearest 0.1g)
  document.getElementById('add-flour').textContent = `${Math.round(addFlour / 1) * 1}g`;
  document.getElementById('add-water').textContent = `${Math.round(addWater / 1) * 1}g`;
  document.getElementById('add-yeast').textContent = `${Math.round(addYeast * 10) / 10}g`;
  
  // Display salt water (water to nearest 5g, salt to nearest 1g)
  document.getElementById('salt-water').textContent = `${Math.round(saltWater / 1) * 1}g`;
  document.getElementById('salt-amount').textContent = `${Math.round(salt)}g`;
}

// Touch/swipe support
let touchStartX = 0;
let touchEndX = 0;

const container = document.querySelector('.panels-container');

container.addEventListener('touchstart', e => {
  touchStartX = e.changedTouches[0].screenX;
}, { passive: true });

container.addEventListener('touchend', e => {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
}, { passive: true });

function handleSwipe() {
  const swipeThreshold = 50;
  const diff = touchStartX - touchEndX;
  
  if (Math.abs(diff) > swipeThreshold) {
    if (diff > 0) {
      // Swiped left
      nextPanel();
    } else {
      // Swiped right
      prevPanel();
    }
  }
}

// Add event listeners for navigation buttons
document.getElementById('nextBtn').addEventListener('click', nextPanel);
document.getElementById('prevBtn').addEventListener('click', prevPanel);

// Initialize
updatePanelDisplay();
</script>

<style>
.panels-container {
  width: 100%;
  position: relative;
}

.panels-wrapper {
  display: flex;
  will-change: transform;
}

.panel {
  min-width: 100%;
}

@media (max-width: 640px) {
  .container {
    padding-left: 0.5rem;
    padding-right: 0.5rem;
  }
  
  .panel {
    padding-left: 0.5rem !important;
    padding-right: 0.5rem !important;
  }
}
</style>
